<div class="top-distance bottom-distance" *ngIf="isGeneralInfoSaved">
  <div class="card history-card border-radius-1">
    <div class="card-header history-header">
      <nav class="nav navbar-pg3">
        <h5>Collaborators</h5>
        <i class="fa fa-info-circle" aria-hidden="true"></i>
      </nav>
    </div>
    <div class="card-body card-paddng">
      <div class="col-12  search-eidted-p padding-15">
        <div class="alert alert-danger " *ngIf="invalidData.invalidCollaboratorInfo">
          Please fill all mandatory fields marked
          <strong>*</strong>
        </div>
      </div>
      <div class="col-12  search-eidted-p padding-15">
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label>Organization
                <span class="mandatory">*</span>
              </label>
              <ng2-completer [class.normal-border]="!isCollaboratorInfoEdit" [datasource]="collaboratorNames" [minSearchLength]="0" [(ngModel)]="collaboratorName"
                (ngModelChange)="setCollaborator(collaboratorName)" class="input-field-size person-unit collaborator-holder"
                placeholder="Name"></ng2-completer>
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label>Point of contact</label>
              <input type="text" [class.poping-border]="isCollaboratorInfoEdit" class="form-control input-field-size" [(ngModel)]="protocolCollaborator.pointOfContact"
                placeholder="Point of contact">
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-group">
              <label>Approval Date</label>
              <div class="input-group date-pickr-1 mb-3">
                <input type="text" class="form-control" [class.poping-border]="isCollaboratorInfoEdit" [owlDateTime]="dt3" [(ngModel)]="protocolCollaborator.approvalDate"
                  (ngModelChange)="validateApprovalDate()" placeholder="mm/dd/yyyy">
                <owl-date-time [pickerType]="'calendar'" #dt3></owl-date-time>
                <div class="input-group-append input-span-1">
                  <span class="input-group-text" [owlDateTimeTrigger]="dt3">
                    <i class="fa fa-calendar" aria-hidden="true"></i>
                  </span>
                </div>
              </div>
              <span *ngIf="invalidData.invalidApprovalDate" class="error">Approval Date should be less than Expiration Date</span>
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-group">
              <label>Expiration Date </label>
              <div class="input-group date-pickr-1 mb-3">
                <input type="text" [class.poping-border]="isCollaboratorInfoEdit" class="form-control" [owlDateTime]="dt4" [(ngModel)]="protocolCollaborator.expirationDate"
                  (ngModelChange)="validateExpirationDate()" placeholder="mm/dd/yyyy">
                <div class="input-group-append input-span-1" [owlDateTimeTrigger]="dt4">
                  <span class="input-group-text" [owlDateTimeTrigger]="dt4">
                    <i class="fa fa-calendar" aria-hidden="true"></i>
                  </span>
                </div>
                <owl-date-time [pickerType]="'calendar'" #dt4></owl-date-time>
              </div>
              <span *ngIf="invalidData.invalidExpirationDate" class="error">Expiration Date should be greater than Approval Date</span>
            </div>
          </div>
          <div class="col-md-1 add-btn-1">
            <button title="Add" *ngIf="!isCollaboratorInfoEdit" type="button" class="btn btn-success top-butn" (click)="addCollaboratorDetails('ADD')">
              <i class="fa fa-plus" aria-hidden="true"></i>
            </button>
            <button title="Save" *ngIf="isCollaboratorInfoEdit" (click)="addCollaboratorDetails('EDIT')" type="button" class="btn btn-success top-butn">
              <i class="fa fa-floppy-o" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-12 users-list-tbl">
        <div class="row">
          <div class="table-responsive">
            <table id="collaboratorTable" class="table table-striped tbl-p-clr" *ngIf="protocolCollaboratorList.length > 0">
              <thead class="tbl-head-clr thead-font-size">
                <tr>
                  <th></th>
                  <th scope="col">Name</th>
                  <th scope="col">Point of contact</th>
                  <th scope="col">Approval Date</th>
                  <th scope="col">Expiration Date</th>
                  <th scope="col">Action</th>
                </tr>
              </thead>
              <tbody *ngFor="let item of protocolCollaboratorList let l=index" class="tbody-font-size">
                <tr [class.poping-border]="l == collaboratorEditIndex">

                  <td>
                    <span class="pdf" title="Click Here" (click)="toggle(item,l)">
                      <i class="fa accordion-toggle" [ngClass]="(iconValue==l)?'fa-minus':'fa-plus'" data-toggle="collapse"
                        [attr.data-target]="'#' + i"></i>
                    </span>
                  </td>
                  <td>{{item.collaboratorNames?.organizationName}}</td>
                  <td>{{item.pointOfContact}}</td>
                  <td>{{item.approvalDate| date:"MM/dd/yyyy"}}</td>
                  <td>{{item.expirationDate| date:"MM/dd/yyyy"}}</td>
                  <td class="action-btn-list">
                    <button title="Edit" (click)="editCollaboratorDetails(item,l)" type="button" class="btn btn-primary edit-btn-1">
                      <i class="fa fa-pencil" aria-hidden="true"></i>
                    </button>
                    <button title="More Details" type="button" (click)="setCollaboratorPersonDetails(item)" class="btn btn-primary view-btn-1" data-toggle="modal"
                      data-target="#collaboratorPersonModal">
                      <i class="fa fa-arrow-right" aria-hidden="true"></i>
                    </button>
                    <button title="Delete" (click)="deleteCollaboratorDetails(l)" type="button" class="btn btn-primary delete-btn-1">
                      <i class="fa fa-trash" aria-hidden="true"></i>
                    </button>
                  </td>
                </tr>
                <tr>
                  <td colspan="12" class="hiddenRow" *ngIf="iconValue==l">
                    <div id={{l}}>
                      <table id="collaboratorTable" class="table table-striped">
                        <tbody>
                          <tr>
                            <td></td>
                            <td class="label-font">Persons</td>
                            <td>
                              <div class="filechipCollaborator" *ngIf="protocolCollaboratorPersons?.length > 0">
                                <span *ngFor="let person of protocolCollaboratorPersons">{{person?.personnelInfo?.personName}}</span>
                              </div>
                              <div class="filechip" *ngIf="protocolCollaboratorPersons?.length == 0">No persons Added</div>
                            </td>
                          </tr>
                          <tr>
                            <td></td>
                            <td class="label-font">Approval Letter</td>
                            <td>
                              <div class="filechipCollaborator pdf" *ngIf="protocolCollaboratorAttachmentsList?.length > 0">
                                <span *ngFor="let protocolCollaboratorAttachment of protocolCollaboratorAttachmentsList" (click)="downloadAttachment(protocolCollaboratorAttachment)"
                                  title="download">{{protocolCollaboratorAttachment?.protocolAttachments?.fileName}}</span>
                              </div>
                              <div class="filechip pdf" *ngIf="protocolCollaboratorAttachmentsList?.length == 0">No Approval letter attached</div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- modal -->
<div class="modal fade bd-example-modal-lg" id="collaboratorPersonModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header popup-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Person Details
        </h5>
        <button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body modal-popup">
        <div class="modal-header-label">
          <h4 class="popup-sub-head">Collaborator</h4>
        </div>
        <!-- section1 -->
        <div class="modal-padding">
          <div class="row">
            <div class="col-md-6 col lg- 6 col-sm-6 col-6">
              <label class="modal-label" for=""> Organization : </label>
              {{protocolCollaboratorSelected?.collaboratorNames?.organizationName}}
            </div>
            <div class="col-md-6 col lg- 6 col-sm-6 col-6">
              <label class="modal-label" for="">Point of contact : </label>
              {{protocolCollaboratorSelected?.pointOfContact}}
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 col lg- 6 col-sm-6 col-6">
              <label class="modal-label" for=""> Approval Date : </label>
              {{protocolCollaboratorSelected?.approvalDate| date:"MM/dd/yyyy"}}
            </div>
            <div class="col-md-6 col lg- 6 col-sm-6 col-6">
              <label class="modal-label" for=""> Expiration Date : </label>{{protocolCollaboratorSelected?.expirationDate| date:"MM/dd/yyyy"}}
            </div>
          </div>
        </div>
        <!-- section2 -->
        <div class="modal-header-label">
          <h4 class="popup-sub-head sub-head-width">Persons</h4>
          <a class="cursor-hover" (click)="isShowAddPerson = !isShowAddPerson">
            <i class="fa fa-plus" aria-hidden="true"> Add Persons</i>
          </a>
        </div>
        <div class="modal-padding">
          <div *ngIf="isShowAddPerson">
            <div *ngIf="personalDataList != null && personalDataList.length > 0">
            <div class="row">
              <div class="col-md-1 col lg- 1 col-sm-1 col-6">
                <label class="modal-label" for="">Add </label>
              </div>
              <div class="col-md-3 col lg- 3 col-sm-3 col-6">
                <label class="modal-label" for="">Name </label>
              </div>
              <div class="col-md-3 col lg- 3 col-sm-4 col-6">
                <label class="modal-label" for="">Role </label>
              </div>
              <div class="col-md-3 col lg- 3 col-sm-3 col-6">
                <label class="modal-label" for="">Affiliation </label>
              </div>
            </div>
            <div class="row" *ngFor="let personalData of personalDataList let i=index">
              <div class="col-md-4 col lg- 4 col-sm-4 col-6 bottom-distance">
                <div class="row">
                  <div class="modal-label col-3 pr-0" for="">
                    <input type="checkbox" [(ngModel)]="isPersonSelected[i]" (Change)="isPersonSelected[i]=!isPersonSelected[i]"
                    /> </div>
                  <div class="col-9">
                    {{personalData.personName}}
                  </div>
                </div>
              </div>
              <div class="col-md-3 col lg- 3 col-sm-3 col-6">
                {{personalData.protocolPersonRoleTypes?.description}}

              </div>
              <div class="col-md-4 col lg- 4 col-sm-4 col-6">
                {{personalData.protocolAffiliationTypes?.description}}
              </div>
            </div>
            <section class="col-12 btn-row-med sect-confirm-padding proceed-btn-align">
              <button title="Add Persons" class="btn btn-primary tab_btn proceed-btn btn-mt-10 center-button" aria-label="Close" (click)="addCollaboratorPerson()">Add</button>
            </section>
          </div>
          <div *ngIf="personalDataList == null || personalDataList.length <= 0" class="alertMsg"><b>No more persons to Add.</b></div>
          </div>
          <div class="popup-div" *ngIf="protocolCollaboratorPersons?.length != 0">
            <table class="table table-striped">
              <thead class="popup-header">
                <tr>
                  <th scope="col">Name</th>
                  <th scope="col">Role</th>
                  <th scope="col">Unit</th>
                  <th scope="col">Affiliation</th>
                  <th scope="col">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let protocolCollaboratorPerson of protocolCollaboratorPersons">
                  <td scope="row">{{protocolCollaboratorPerson?.personnelInfo?.personName}}</td>
                  <td>{{protocolCollaboratorPerson?.personnelInfo?.protocolPersonRoleTypes?.description}}</td>
                  <td>{{protocolCollaboratorPerson?.personnelInfo?.protocolLeadUnits[0]?.protocolPersonLeadUnits?.unitName}}</td>
                  <td>{{protocolCollaboratorPerson?.personnelInfo?.protocolAffiliationTypes?.description}}</td>
                  <td><ul class="actionButtonGroup padding-icons">
                      <li>
                        <a title="Remove Person" (click)="deletePerson(protocolCollaboratorPerson)">
                          <i class="fa fa-trash-o delete-color"></i>
                        </a>
                      </li>
                      </ul>
                      </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- section3 -->
        <div class="modal-header-label">
          <h4 class="popup-sub-head sub-head-width">Attachments</h4>
          <a class="cursor-hover" (click)="isShowAddAttachment = !isShowAddAttachment">
            <i class="fa fa-plus" aria-hidden="true"> Add Attachments</i>
          </a>
        </div>
        <div class="modal-padding">
          <div class="row mb-15" *ngIf="isShowAddAttachment">
            <div class="row col-12 form-group">
              <div class="col-4 apprve-date">
                <h4>*Type</h4>
                <select class="custom-select mr-sm-2" id="inlineFormCustomSelect" [(ngModel)]="requestObject.attachmentTypeCode" (ngModelChange)="setAttachmentType(requestObject.attachmentTypeCode)">
                  <option value=null selected>Please Select</option>
                  <option *ngFor="let attachmentType of attachmentTypes" value="{{attachmentType.typeCode}}">{{attachmentType.description}}</option>
                </select>
              </div>
              <div class="col-8 apprve-date">
                <h4 class="ml-10">*Description</h4>
                <textarea rows="1" cols="2" class="form-control txt-area-fnt modal-table-padding " placeholder="Description" [(ngModel)]="requestObject.attachmentDescription"></textarea>
              </div>
            </div>
            <div class="col-12">
              <file-drop customstyle="file-drop-color" (onFileDrop)="dropped($event)">
                <button title="Choose Files" class="btnSkin btnSkinPrimary mt-40" (click)="triggerAdd()">Choose Files
                </button>
                <input type="file" #file (change)="onChange(file.files)" multiple id="addAttach" style="display: none" />
                <div style="color: #a92034; margin-left: 10px;  margin-top: 40px;">OR Drop files here
                </div>
              </file-drop>
            </div>
            <div class="filechip pl-5">
              <span *ngFor="let item of uploadedFile; let i=index">{{ item.name }}
                <i class="fa fa-close pdf" title="Remove Attachment" (click)="deleteFromUploadedFileList(item)"></i>
              </span>
            </div>
            <section class="col-12 btn-row-med sect-confirm-padding proceed-btn-align">
              <button title="Add Attachment" class="btn btn-primary tab_btn proceed-btn btn-mt-10 center-button" *ngIf="!isAttachmentEdit"
                aria-label="Close" (click)="addAttachments()">Add</button>
            </section>
          </div>
          <div class="popup-div" *ngIf="protocolCollaboratorAttachmentsList?.length!=0">
            <table class="table table-striped">
              <thead class="popup-header">
                <tr>
                  <th scope="col">Type</th>
                  <th scope="col">Description</th>
                  <th scope="col" style="width: 30%" class="padding-table-content">File</th>
                  <th scope="col" class="padding-table-content">Updated By</th>
                  <th scope="col">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let protocolCollaboratorAttachment of protocolCollaboratorAttachmentsList">
                  <td>{{protocolCollaboratorAttachment?.attachmentType?.description}}</td>
                  <td>{{protocolCollaboratorAttachment?.description}}</td>
                  <td style="width: 30%" class="padding-table-content">{{protocolCollaboratorAttachment?.protocolAttachments?.fileName}}</td>
                  <td class="padding-table-content">{{protocolCollaboratorAttachment?.updateUser}} {{(protocolCollaboratorAttachment?.updateTimestamp ==='
                    ' || protocolCollaboratorAttachment.updateTimestamp ===null) ? ' ':(protocolCollaboratorAttachment.updateTimestamp
                    | date: 'MM/dd/yyyy')}}</td>
                  <td>
                    <ul class="actionButtonGroup padding-icons">
                      <li>
                        <a title="Delete Attachment" (click)="tempSave($event,protocolCollaboratorAttachment)" data-toggle="modal" data-target="#deleteAttachment">
                          <i class="fa fa-trash-o delete-color"></i>
                        </a>
                      </li>
                      <li>
                        <a (click)="downloadAttachment(protocolCollaboratorAttachment)" title="Download Attachment">
                          <i class="fa fa-download download-color" aria-hidden="true"></i>
                        </a>
                      </li>
                    </ul>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>
<!-- modal-end -->
<div class="modal fade mySkinDialog modalFallBack" *ngIf="showPopup" id="deleteAttachment" tabindex="-1" role="dialog" aria-labelledby="deleteModalTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content modal-text-color">
      <div class="modal-header popup-header">
        <h5 class="modal-title modal-text-color">Want to delete?</h5>

        <button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this item?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn pop-up-color tab_btn proceed-btn pdf" data-dismiss="modal" data-toggle="modal" (click)="showPopup = false">No</button>
        <button type="button" class="btn pop-up-color tab_btn proceed-btn pdf" (click)="deleteAttachments()" data-dismiss="modal">Yes</button>
      </div>
    </div>
  </div>
</div>