<ngx-spinner bdOpacity=0.5 bdColor="#333" color="#fff" type="ball-spin-clockwise-fade" loadingText="Loading..."></ngx-spinner>
<div class="headerPush"></div>
<div class="container-fluid">
    <div class="borderBox irb-margin-top irb-background-tablemaintenance">
        <h4 class="borderBoxHeading irb-head-back font-size-1em">Training Details</h4>
        <section>
            <!-- <div class="row"> -->
            <div class="col-md-12  search-eidted-p padding0" *ngIf="invalidData.invalidPersonData">
                <div class="alert alert-danger" [innerHTML]="warningMessage">
                </div>
            </div>
            <!-- </div> -->
            <div class="row outerpadding">
                <div class="text-right persons-header width-99" *ngIf="mode == 'view'">
                    <i class="fa fa-user-circle" aria-hidden="true"> &nbsp;Employee</i> &nbsp;
                    <i class="fa fa-user-o" aria-hidden="true">&nbsp; Non Employee</i>
                </div>
                <div class="col-md-4">
                    <div class="form-group" *ngIf="mode != 'view'">
                        <div class="form-check-inline">
                            <label class="form-check-label">
                                <input type="radio" class="form-check-input" name="empOptradioDetail" value="employee" [(ngModel)]="personType" (ngModelChange)="changePersonType(personType)">Employee
                            </label>
                        </div>
                        <div class="form-check-inline">
                            <label class="form-check-label">
                                <input type="radio" class="form-check-input" name="empOptradioDetail" value="non-employee" [(ngModel)]="personType" (ngModelChange)="changePersonType(personType)">Non-Employee
                                <span class="mandatory">*</span>
                            </label>
                        </div>
                        <app-elastic [options]="options" [placeHolder]="elasticPlaceHolder" [clearField]="clearField" [defaultValue]="defaultValue"
                            (selectedResult)="selectPersonElasticResult($event)"></app-elastic>
                    </div>
                    <div class="form-group" *ngIf="mode == 'view'">
                        <label>Person Name</label>
                        <div>
                            <i class="fa" [ngClass]="personnelTrainingInfo.IS_EMPLOYEE == 'Y' ? 'fa-user-circle':'fa-user-o'"
                                aria-hidden="true"></i> {{personnelTrainingInfo.FULL_NAME}}</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Completion Date</label>
                        <div class="input-group  mb-2" *ngIf="mode != 'view'">
                            <input type="text" class="form-control" [(ngModel)]="personnelTrainingInfo.DATE_ACKNOWLEDGED" (ngModelChange)="validateAckDate()"
                                [owlDateTime]="trainingAckDate" placeholder="mm/dd/yyyy">
                            <owl-date-time [pickerType]="'calendar'" #trainingAckDate></owl-date-time>
                            <div class="input-group-append input-span-1" [owlDateTimeTrigger]="trainingAckDate">
                                <!-- <span class="input-group-text"> -->
                                <i class="fa fa-calendar" aria-hidden="true"></i>
                                <!-- </span> -->
                            </div>
                        </div>
                        <div *ngIf="mode == 'view'">{{(personnelTrainingInfo?.DATE_ACKNOWLEDGED === ' ' || personnelTrainingInfo?.DATE_ACKNOWLEDGED ===
                            null ) ? ' ':(personnelTrainingInfo?.DATE_ACKNOWLEDGED | date: 'MM/dd/yyyy')}}</div>
                    </div>
                    <span *ngIf="invalidData.invalidAckDate" class="error">Acknowledgement Date should be less than Expiration Date</span>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label>Expiration Date</label>
                        <div class="input-group  mb-2" *ngIf="mode != 'view'">
                            <input type="text" class="form-control" [(ngModel)]="personnelTrainingInfo.EXPIRATION_DATE" (ngModelChange)="validateExpDate()"
                                [owlDateTime]="trainingExpDate" placeholder="mm/dd/yyyy">
                            <owl-date-time [pickerType]="'calendar'" #trainingExpDate></owl-date-time>
                            <div class="input-group-append input-span-1" [owlDateTimeTrigger]="trainingExpDate">
                                <!-- <span class="input-group-text"> -->
                                <i class="fa fa-calendar" aria-hidden="true"></i>
                                <!-- </span> -->
                            </div>
                        </div>
                        <div *ngIf="mode == 'view'">{{(personnelTrainingInfo?.EXPIRATION_DATE === ' ' || personnelTrainingInfo?.EXPIRATION_DATE === null
                            ) ? ' ':(personnelTrainingInfo?.EXPIRATION_DATE | date: 'MM/dd/yyyy')}}</div>
                    </div>
                    <span *ngIf="invalidData.invalidExpDate" class="error">Expiration Date should be greater than Acknowledgement Date</span>
                </div>
            </div>
            <div class="row">
                <div class="col-12" *ngIf="showPersonElasticBand">
                    <div>
                        <div class="col-12 band-s">
                            <div class="col-12 padding0 close-bt" (click)="showPersonElasticBand = false">X</div>
                            <div class="row">
                                <div class="col-12">
                                    <label>Name:</label>
                                    <span>{{selectedPerson?.full_name}}</span>
                                </div>
                                <div class="col-12">
                                    <label>Username:</label>
                                    <span>{{selectedPerson?.user_name}}</span>
                                    <label>Email:</label>
                                    <span>{{selectedPerson?.email_address}}</span>
                                    <label>Phone no:</label>
                                    <span>{{selectedPerson?.phone_number}}</span>
                                    <label>Title:</label>
                                    <span>{{selectedPerson?.title}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-11">
                    <div class="form-group">
                        <label>
                            Training
                            <span *ngIf="mode != 'view'" class="mandatory">*</span>
                        </label>
                        <input *ngIf="mode != 'view'" type="text" class="form-control input-field-size" [(ngModel)]="personnelTrainingInfo.TRAINING"
                            placeholder="Search for a Training" (ngModelChange)="getTrainingList()" (keyup)="isTrainingSearch = true"
                            (focusout)="isTrainingSearch = false" (keydown.arrowdown)="keyPressEvent.onKeyDown($event,'trainingDropDown')"
                            (keydown.arrowup)="keyPressEvent.onKeyDown($event,'trainingDropDown')" (keydown.Enter)="keyPressEvent.onKeyDown($event,'trainingDropDown')">
                        <div class="sb-seachresults top-margin research-dropDown-width mt-40" id="trainingDropDown">
                            <ul class="sb-results-dropdown-menu" *ngIf="isTrainingSearch">
                                <ng-container *ngIf="trainingSearchResult.length > 0">
                                    <li *ngFor="let result of trainingSearchResult" (mousedown)="selectedTraining(result.DESCRIPTION,result.TRAINING_CODE)" (click)="selectedTraining(result.DESCRIPTION,result.TRAINING_CODE)">
                                        <span> {{result.DESCRIPTION}}</span>
                                    </li>
                                </ng-container>
                                <ng-container *ngIf="trainingSearchResult.length == 0">
                                    <li>No Results</li>
                                </ng-container>
                            </ul>
                        </div>
                        <div *ngIf="mode == 'view'">{{personnelTrainingInfo.TRAINING}}</div>
                    </div>
                </div>
                <div class="col-md-1 add-btn-1" *ngIf="mode != 'view'">
                    <button title="Save" type="button" class="btn btn-success top-butn" (click)="savePersonTrainingDetails()">
                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-12 schedule-box" *ngIf="requestObject.personTrainingId != null">
                <h4 class="borderBoxHeading text-color pl-0">
                    <span class="font-size-1em">Training Comments</span>
                    <span *ngIf="mode != 'view'" class="float-right pointer" (click)="showCommentDiv = !showCommentDiv">
                        <i class="fa fa-plus"></i> Add Comments</span>
                </h4>
                <div class="ml-0 mt-10" *ngIf="showCommentDiv">
                    <div class="row">
                        <div class="col-md-12  search-eidted-p" *ngIf="invalidData.invalidCommentData">
                            <div class="alert alert-danger">Please fill Mandatory fields marked
                                <strong>*</strong>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-11">
                            <div class="form-group">
                                <label>
                                    Comments
                                    <span class="mandatory">*</span>
                                </label>
                                <textarea class="form-control txt-area-fnt" [class.poping-border]="isCommentEdit" [(ngModel)]="personTrainingComments.commentDescription"
                                    placeholder="Comments"></textarea>
                            </div>
                        </div>
                        <div class="col-md-1 add-btn-1">
                            <button title="Add" *ngIf="!isCommentEdit" type="button" class="btn btn-success top-butn" (click)="addTrainingComment()">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </button>
                            <button title="Save" *ngIf="isCommentEdit" type="button" class="btn btn-success top-butn" (click)="saveTrainingComment()">
                                <i class="fa fa-floppy-o" aria-hidden="true"></i>
                            </button>
                        </div>

                    </div>
                </div>

                <div class="col-md-12 users-list-tbl" *ngIf="mode == 'view' || (mode != 'view' && personnelTrainingComment.length > 0)">
                    <div class="row">
                        <div class="table-responsive">
                            <table class="table table-striped tbl-p-clr">
                                <thead class="tbl-head-clr thead-font-size">
                                    <tr>
                                        <th width="65%" scope="col">Comments</th>
                                        <th scope="col">Update User</th>
                                        <th scope="col" *ngIf="mode != 'view'" width="15%">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ng-container *ngIf="personnelTrainingComment.length > 0">
                                        <tr [class.poping-border]="i == commentSelectedRow" *ngFor="let comment of personnelTrainingComment let i = index">
                                            <td width="65%">{{comment.COMMENT_DESCRIPTION}}</td>
                                            <td>{{comment.UPDATE_USER}}</td>
                                            <td class="action-btn-list" *ngIf="mode != 'view'" width="15%">
                                                <button title="Edit" type="button" class="btn btn-primary edit-btn-1" (click)="editTrainingComment(comment,i)">
                                                    <i class="fa fa-pencil" aria-hidden="true"></i>
                                                </button>
                                                <button title="Delete" type="button" class="btn btn-primary delete-btn-1" (click)="deleteTrainingComment(comment)" data-toggle="modal"
                                                    data-target="#deletewarningModal">
                                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </ng-container>
                                    <tr *ngIf="(personnelTrainingComment.length == 0 || personnelTrainingComment == null) && mode != 'view'">
                                        <td class="text-center" colspan="3">No Comments to show</td>
                                    </tr>
                                    <tr *ngIf="(personnelTrainingComment.length == 0 || personnelTrainingComment == null) && mode=='view'">
                                            <td class="text-center" colspan="2">No Comments to show</td>
                                        </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="top-distance" *ngIf="requestObject.personTrainingId != null || (mode == 'view' && personnelTrainingComment.length > 0)">
                <div class="col-md-12 schedule-box">
                    <h4 class="borderBoxHeading text-color pl-0">
                        <span class="font-size-1em">Training Attachments</span>
                        <span *ngIf="mode != 'view'" class="float-right pointer" data-toggle="modal"
                            data-target="#attachmentModal">
                            <i class="fa fa-plus"></i> Add Attachment</span>
                    </h4>

                    <div class="col-md-12 users-list-tbl" *ngIf="mode == 'view' || (mode != 'view' && personnelTrainingAttachments.length > 0)">
                        <div class="row">
                            <div class="table-responsive">
                                <table class="table table-striped tbl-p-clr">
                                    <thead class="tbl-head-clr thead-font-size">
                                        <tr>
                                            <th scope="col">File Name</th>
                                            <th width="20%" scope="col">Description</th>
                                            <th scope="col">Update User</th>
                                            <th scope="col" width="15%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <ng-container *ngIf="personnelTrainingAttachments.length > 0">
                                            <tr *ngFor="let attachment of personnelTrainingAttachments">
                                                <td>{{attachment.FILE_NAME}}</td>
                                                <td width="20%">{{attachment.DESCRIPTION}}</td>
                                                <td>{{attachment.UPDATE_USER}}</td>
                                                <td class="action-btn-list" width="15%">
                                                    <!-- <button title="Edit" type="button" class="btn btn-primary edit-btn-1" (click)="editTrainingAttachment(attachment)">
                                                              <i class="fa fa-pencil" aria-hidden="true"></i>
                                                            </button> -->
                                                    <button title="download" type="button" class="btn btn-primary view-btn-1" (click)="downloadTrainingAttachment(attachment)">
                                                        <i class="fa fa-download" aria-hidden="true"></i>
                                                    </button>
                                                    <button title="Delete" *ngIf="mode != 'view'" type="button" class="btn btn-primary delete-btn-1" (click)="deleteTrainingAttachment(attachment)"
                                                        data-toggle="modal" data-target="#deletewarningModal">
                                                        <i class="fa fa-trash" aria-hidden="true"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </ng-container>
                                        <tr *ngIf="personnelTrainingAttachments.length == 0 || personnelTrainingAttachments == null">
                                            <td class="text-center" colspan="4">No Attachments to show</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



        </section>
    </div>
</div>

<!--attachment modal-->
<div class="modal fade" id="attachmentModal" tabindex="-1" role="dialog" aria-labelledby="helpModalCenterTitle" aria-hidden="true"
    data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-full" role="document">
        <div class="modal-content">
            <div class="modal-header popup-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Add Attachment</h5>
                <button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close" (click)="dismissAttachmentModal()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body modal-popup">
                <div class="modal-padding">
                    <div class="alert alert-danger " *ngIf="noFileChoosen">
                        Please choose atleast one file to add
                        <strong>*</strong>
                    </div>
                    <div class="alert alert-danger " *ngIf="multipleFile">
                        Cannot Add Multiple Files
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Description
                                    <!-- <span class="mandatory">*</span> -->
                                </label>
                                <textarea [(ngModel)]="personnelTrainingAttachment.description" rows="1" cols="2" class="form-control txt-area-fnt" placeholder="Description"></textarea>
                            </div>
                        </div>
                    </div>
                    <file-drop customstyle="file-drop-color" (onFileDrop)="dropped($event)">
                        <button title="Choose Files" class="btnSkin btnSkinPrimary mt-40" (click)="triggerAdd()">Choose Files
                        </button>
                        <input type="file" #file (change)="onChange(file.files)" id="addAttach" style="display: none" />
                        <div style="color: #a92034; margin-left: 10px;  margin-top: 40px;">OR Drop files here
                        </div>
                    </file-drop>
                    <div class="filechip">
                        <span *ngFor="let item of uploadedFile; let i=index">{{ item.name }}
                            <i class="fa fa-close pdf" title="Remove Attachment" (click)="deleteFromUploadedFileList(item)"></i>
                        </span>
                    </div>
                    <div class="filechip" *ngIf="isReplaceAttachment">
                        <span>{{ fileName }}
                            <i title="Replace Attachment" class="fa fa-close pdf" (click)="replaceAttachment()"></i>
                        </span>
                    </div>
                </div>
            </div>
            <section class="col-12 btn-row-med sect-confirm-padding proceed-btn-align">
                <button title="Add Attachment" class="btn btn-primary tab_btn proceed-btn btn-mt-10 center-button" (click)="addTrainingAttachment()"
                    aria-label="Close">Add</button>
                <!--Button for dismissing modal-->
                <button id="cancelbtn" data-dismiss="modal" style="display:none"></button>
                <!-- <button title="Save Attachment" class="btn btn-primary tab_btn proceed-btn btn-mt-10 center-button" *ngIf="isAttachmentEdit"
        aria-label="Close">Save</button> -->
            </section>
        </div>
    </div>
</div>
<!--delete Warning modal-->
<div class="modal fade" *ngIf="showPopup" id="deletewarningModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalTitle"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header popup-header">
                <h5 class="modal-title">Want to delete?
                </h5>
                <button type="button" class="close modal-close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body modal-pop-up">
                <p>Are you sure you want to delete this item?</p>
            </div>
            <div class="modal-footer btn-row-med">
                <button class="btn tab_btn" data-dismiss="modal" aria-label="Close" (click)="showPopup = false">No</button>
                <!-- <button type="button margin-class"  class="btn btn-primary tab_btn proceed-btn" data-dismiss="modal" (click)="cancelDelete()">No</button> -->
                <button type="button margin-class" *ngIf="isCommentDelete" class="btn btn-primary tab_btn" (click)="saveTrainingComment()"
                    data-dismiss="modal">Yes</button>
                <button type="button margin-class" *ngIf="!isCommentDelete" class="btn btn-primary tab_btn" (click)="saveAttachment()" data-dismiss="modal">Yes</button>
            </div>
        </div>
    </div>
</div>